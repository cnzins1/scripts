-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol
-- paster lol


local rs, players = game:GetService("ReplicatedStorage"), game:GetService("Players")
local cam, util = workspace.CurrentCamera, require(rs.Modules.Utility)

local function getPlayers()
    local entities = {}
    for _, child in workspace:GetChildren() do
        if child:FindFirstChildOfClass("Humanoid") then
            table.insert(entities, child)
        elseif child.Name == "HurtEffect" then
            for _, hurtPlayer in child:GetChildren() do
                if hurtPlayer.ClassName ~= "Highlight" then
                    table.insert(entities, hurtPlayer)
                end
            end
        end
    end
    return entities
end

local function getClosestPlayer()
    local closest, closestDist = nil, math.huge
    local char = players.LocalPlayer.Character
    if not char then return end

    for _, player in getPlayers() do
        if player == players.LocalPlayer or not player:FindFirstChild("HumanoidRootPart") then continue end
        local pos, onScreen = cam:WorldToViewportPoint(player.HumanoidRootPart.Position)
        if not onScreen then continue end

        local dist = (Vector2.new(cam.ViewportSize.X / 2, cam.ViewportSize.Y / 2) - Vector2.new(pos.X, pos.Y)).Magnitude
        if dist < closestDist then
            closest, closestDist = player, dist
        end
    end
    return closest
end

local oldRaycast = util.Raycast
util.Raycast = function(...)
    local args = {...}
    if #args > 0 and args[4] == 999 then
        local closest = getClosestPlayer()
        if closest then args[3] = closest.Head.Position end
    end
    return oldRaycast(table.unpack(args))
end
